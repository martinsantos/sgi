<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Facturas Recibidas</h2>
  <div class="btn-group" role="group">
    <button type="button" class="btn btn-success" onclick="exportarFacturasRecibidas()">
      <i class="bi bi-file-earmark-excel"></i> Exportar Excel
    </button>
    <button type="button" class="btn btn-primary" onclick="window.location.href='/facturas/nueva-recibida'">
      <i class="bi bi-plus"></i> Nueva Factura
    </button>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0">Filtros de Búsqueda</h5>
  </div>
  <div class="card-body">
    <form id="formBusqueda" class="row g-3">
      <div class="col-md-3">
        <label for="numero_factura" class="form-label">N° Factura</label>
        <input type="text" class="form-control" id="numero_factura" name="numero_factura" placeholder="N° Factura">
      </div>
      <div class="col-md-3">
        <label for="proveedor" class="form-label">Proveedor</label>
        <input type="text" class="form-control" id="proveedor" name="proveedor" placeholder="Nombre del proveedor">
      </div>
      <div class="col-md-2">
        <label for="fecha_desde" class="form-label">Desde</label>
        <input type="date" class="form-control" id="fecha_desde" name="fecha_desde">
      </div>
      <div class="col-md-2">
        <label for="fecha_hasta" class="form-label">Hasta</label>
        <input type="date" class="form-control" id="fecha_hasta" name="fecha_hasta">
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary me-2">
          <i class="bi bi-search"></i> Buscar
        </button>
        <button type="button" id="btnLimpiar" class="btn btn-outline-secondary">
          <i class="bi bi-x-circle"></i>
        </button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover" id="tablaFacturas">
        <thead>
          <tr>
            <th>N° Factura</th>
            <th>Fecha</th>
            <th>Proveedor</th>
            <th class="text-end">Total</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="6" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
              <p class="mt-2 mb-0">Cargando facturas recibidas...</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

{{#section 'scripts'}}
<script src="/js/facturas-recibidas.js?v=20251114-1100"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Inicializar el gestor de facturas recibidas
    window.facturasRecibidasManager = new FacturasRecibidasManager();
    
    // Manejar búsqueda
    $('#formBusqueda').on('submit', function(e) {
      e.preventDefault();
      if (window.facturasRecibidasManager) {
        window.facturasRecibidasManager.currentPage = 1;
        window.facturasRecibidasManager.applyAdvancedFilters();
        window.facturasRecibidasManager.loadData();
      }
    });

    // Manejar botón limpiar
    $('#btnLimpiar').on('click', function() {
      $('#formBusqueda')[0].reset();
      if (window.facturasRecibidasManager) {
        window.facturasRecibidasManager.currentPage = 1;
        window.facturasRecibidasManager.currentFilters = {};
        window.facturasRecibidasManager.loadData();
      }
    });

    // Export function
    window.exportarFacturasRecibidas = function() {
      if (window.facturasRecibidasManager) {
        const params = new URLSearchParams({
          page: window.facturasRecibidasManager.currentPage,
          limit: window.facturasRecibidasManager.limit,
          ...window.facturasRecibidasManager.currentFilters
        });
        window.location.href = `/facturas/api/facturas/recibidas/exportar?${params.toString()}`;
      }
    };
    
    // Auto-cargar datos
    setTimeout(() => {
      if (window.facturasRecibidasManager) {
        window.facturasRecibidasManager.loadData();
      }
    }, 100);
  });
</script>
{{/section}}
