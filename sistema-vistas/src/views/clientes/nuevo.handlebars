<div class="container-fluid mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Nuevo Cliente</h4>
        </div>
        <div class="card-body">
            {{#if error}}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>Error:</strong> {{error}}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {{/if}}
            
            <form id="clienteForm" method="POST" action="/clientes/nuevo">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="nombre" name="nombre">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="codigo" class="form-label">Código</label>
                            <input type="text" class="form-control" id="codigo" name="codigo">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="tipo_cliente" class="form-label">Tipo de Cliente</label>
                            <select class="form-control" id="tipo_cliente" name="tipo_cliente">
                                <option value="">Seleccionar...</option>
                                <option value="1">Cliente</option>
                                <option value="2">Proveedor</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="tipo_persona" class="form-label">Tipo de Persona</label>
                            <select class="form-control" id="tipo_persona" name="tipo_persona">
                                <option value="">Seleccionar...</option>
                                <option value="Física">Persona Física</option>
                                <option value="Jurídica">Persona Jurídica</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="condicion_iva" class="form-label">Condición IVA</label>
                            <select class="form-control" id="condicion_iva" name="condicion_iva">
                                <option value="">Seleccionar...</option>
                                <option value="1">IVA Responsable Inscripto</option>
                                <option value="2">IVA Responsable No Inscripto</option>
                                <option value="3">IVA Exento</option>
                                <option value="4">No Responsable</option>
                                <option value="5">Consumidor Final</option>
                                <option value="6">Responsable Monotributo</option>
                                <option value="7">Sujeto No Categorizado</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="ejemplo@correo.com">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="telefono" name="telefono" placeholder="+54 9 261 123-4567">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="cuil_cuit" class="form-label">CUIL/CUIT</label>
                            <input type="text" class="form-control" id="cuil_cuit" name="cuil_cuit" placeholder="20-12345678-9">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="contacto_principal" class="form-label">Contacto Principal</label>
                            <input type="text" class="form-control" id="contacto_principal" name="contacto_principal" placeholder="Nombre del contacto">
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                        <button type="submit" class="btn btn-success me-2">
                            <i class="bi bi-save"></i> Guardar Cliente
                        </button>
                        <a href="/clientes" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Volver al Listado
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById('clienteForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Mostrar indicador de carga
    const submitBtn = document.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Guardando...';
    submitBtn.disabled = true;
    
    try {
        const formData = new FormData(this);
        const response = await fetch('/clientes/nuevo', {
            method: 'POST',
            body: formData,
            credentials: 'include',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (response.ok) {
            const result = await response.json();
            if (result.success) {
                // Redirigir al listado
                window.location.href = '/clientes';
            } else {
                alert('Error: ' + (result.message || 'No se pudo guardar el cliente'));
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        } else {
            const error = await response.text();
            alert('Error al guardar: ' + error);
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error de conexión: ' + error.message);
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});
</script>
